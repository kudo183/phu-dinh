@model PhuDinhWeb.Models.LogOnModel
@{
    Layout = null;
    ViewBag.Title = "Dang nhap";
}
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width">
<title>@ViewBag.Title</title>
<link href="@Url.Content("~/Content/LogOn.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/jquery-1.7.1.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/modernizr-2.5.3.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<script src="https://apis.google.com/js/platform.js" type="text/javascript"></script>
<script>
    $(document).ready(function () {
        document.getElementById("googleLogOut").href =
            "https://www.google.com/accounts/Logout?continue=https://appengine.google.com/_ah/logout?continue=" + window.location.href;
    });
</script>

@Html.ValidationSummary(true, "Dang nhap that bai!")

@using (Html.BeginForm())
{
    <div>
        <fieldset>
            <legend>Thong tin dang nhap</legend>

            <div class="editor-field">
                @Html.HiddenFor(m => m.UserName)
            </div>

            <div class="editor-label">
                @Html.LabelFor(m => m.Password)
            </div>
            <div class="editor-field">
                @Html.PasswordFor(m => m.Password)
                @Html.ValidationMessageFor(m => m.Password, "Vui long nhap mat khau.")
            </div>

            <div class="editor-label">
                @Html.CheckBoxFor(m => m.RememberMe)
                @Html.LabelFor(m => m.RememberMe)
            </div>

            <p>
                <input id="submit" type="submit" value="Dang nhap" />
            </p>
            <div class="g-signin2" data-onsuccess="onSignIn" data-theme="dark"></div>
            <a id="googleLogOut">Sign out Google</a>

            <div>
                <fb:login-button scope="public_profile,email" onlogin="checkLoginState();" />
            </div>
            <a href='javascript:;' onclick='logoutFB();'>Log out FaceBook</a>
        </fieldset>
    </div>
}

<script>
    //Init the Google api
    gapi.load('auth2', function () {
        gapi.auth2.init({
            client_id: '735134733733-c5h3gefmuokq7u6hl802q2u8sv8f4r7c.apps.googleusercontent.com'
        });
    });

    // Load the Facebook SDK asynchronously
    (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    //Init the Facebook api
    window.fbAsyncInit = function () {
        FB.init({
            appId: '368482453361134',
            cookie: true,  // enable cookies to allow the server to access 
            // the session
            xfbml: true,  // parse social plugins on this page
            version: 'v2.2' // use version 2.2
        });
    };

</script>

<script>
    function onSignIn(googleUser) {
        // The ID token you need to pass to your backend:
        var id_token = googleUser.getAuthResponse().id_token;
        console.log(id_token);
        document.getElementById("Password").value = id_token;
        document.getElementById("UserName").value = "Google";
    };
</script>

<script>
    function logoutFB() {
        FB.logout(function (response) {
            // user is now logged out
        });
    }
    function checkLoginState() {
        FB.getLoginStatus(function (response) {
            statusChangeCallback(response);
        });
    }
    // This is called with the results from from FB.getLoginStatus().
    function statusChangeCallback(response) {
        if (response.status === 'connected') {
            console.log(response.authResponse.accessToken);
            document.getElementById("Password").value = response.authResponse.accessToken;
            document.getElementById("UserName").value = "FaceBook";
        }
    }
</script>
